[ui]
default-command = "log"
# diff.tool=["difft", "--color=always", "$left", "$right"]
diff-formatter=["delta", "$left", "$right"]
diff-editor = ":builtin"
merge-editor = "meld"

[revsets]
# i use a bunch of emails; easier to just track author name
log = "@ | trunk()..author(substring:\"jyn\") | trunk()"

[revset-aliases]
'trunk' = 'trunk()'
'0' = 'trunk()'

[user]
name = "jyn"
email = "github@jyn.dev"

[aliases]
c = ["commit"]
n = ["new"]
e = ["edit"]
l = ["log"]
d = ["diff"]
s = ["status"]
r = ["rebase"]
sh = ["show"]
push = ["git", "push"]
p = ["push"]
fetch = ["git", "fetch"]
f = ["fetch"]
branch-log = ["log", "--revisions", "trunk()..@"]
amend = ["squash"]

[templates]
git_push_bookmark = '"jyn/" ++ description.split(regex:"\s").first()'
[template-aliases]
'format_short_signature(signature)' = 'label("username", signature.name())'
'format_timestamp(timestamp)' = 'timestamp.ago()'

# `jj config list --include-defaults template-aliases.builtin_log_compact`
# the only difference here is turning the newline into a space lol
"builtin_log_compact(commit)" = '''
if(commit.root(),
  format_root_commit(commit),
  label(
    separate(" ",
      if(commit.current_working_copy(), "working_copy"),
      if(commit.immutable(), "immutable", "mutable"),
      if(commit.conflict(), "conflicted"),
    ),
    concat(
      format_short_commit_header(commit) ++ " ",
      separate(" ",
        if(commit.empty(), empty_commit_marker),
        if(commit.description(),
          commit.description().first_line(),
          label(if(commit.empty(), "empty"), description_placeholder),
        ),
      ) ++ "\n",
    ),
  )
)
'''

# move git_head and bookmarks earlier
"format_short_commit_header(commit)" = '''
separate(" ",
  format_short_change_id_with_change_offset(commit),
  if(commit.contained_in('first_parent(@)'), label("git_head", "HEAD")),
  commit.bookmarks(),
  commit.tags(),
  format_short_signature(commit.author()),
  format_timestamp(commit_timestamp(commit)),
  commit.working_copies(),
  format_short_commit_id(commit.commit_id()),
  format_commit_labels(commit),
  if(config("ui.show-cryptographic-signatures").as_boolean(),
    format_short_cryptographic_signature(commit.signature())
  ),
)
'''
