# See https://git-scm.com/docs/git-config#_configuration_file for docs
[user]
	name = jyn
[credential]
	helper = cache
[push]
	default = current
	autoSetupRemote = true
[core]
	eol = lf
	preloadindex = true
	autocrlf = input
	excludesfile = ~/.config/git/ignore
	pager = delta
[interactive]
	diffFilter = delta --color-only
[delta]
	tabs = 0  # NOTE: this is currently kinda broken, see https://github.com/dandavison/delta/pull/751
	navigate = true
	hyperlinks = true
	# TODO: support line numbers
	hyperlinks-file-link-format = "file://{path}"
[alias]
# typos
	rebsae = rebase

# shorthands
	up = update
	a = add
	b = branch
	c = commit
	co = checkout
	cp = cherry-pick
	conf = config
	d = diff
	h = help
	r = remote
	t = tag
	v = !git --version
	update = submodule update
	module = submodule
	deepen = pull --unshallow
	unshallow = pull --unshallow
	amend = commit --amend
	fixup = commit --fixup
	fetch-up = fetch-update
	msg = message

# options that can't be overridden in config
	f = fetch --no-progress --filter=blob:none
	l = log --graph --oneline --format=format:'%C(auto)%h%d %s %C(green)%cr %C(bold blue)<%an>%C(auto)'
	p = push --no-progress
	pf = push --force-with-lease --force-if-includes --no-progress
	s = status -sb --ignore-submodules=dirty

# custom commands
	message = log --format=%B -n1
	fetch-update = !git fetch upstream && git rebase upstream/HEAD
	rdiff = range-diff upstream/HEAD @{u} HEAD
	update = !git fetch-update && git rdiff && read -p "'push? [y/N] '" REPLY && [ \"$REPLY\" = y ] && git pf
	new = !git fetch upstream && git checkout upstream/HEAD && git checkout -b
	delta-diff = !env -u GIT_EXTERNAL_DIFF git diff
	pure-diff = !env -u GIT_EXTERNAL_DIFF git -c core.pager= diff
	stat = l --stat upstream..
	branch-log = !git l $(git merge-base HEAD upstream/HEAD)..
	graph = l --all
	signed = log --show-signature --oneline upstream..

	recent = for-each-ref --sort=committerdate --format='%(committerdate:short): %(color:green)%(refname:short)%(color:default): %(contents:subject)' refs/heads/

	# https://stackoverflow.com/questions/3161204/how-to-find-the-nearest-parent-of-a-git-branch
	parent = !git show-branch --topo-order --current "upstream/*" | grep -v "^\\s*!" | grep "refs/remotes/upstream/" | grep "^[^\\[]*\\*" | head -n1 | grep -Eo "refs/remotes/upstream/[^]]*" | xargs git rev-parse --symbolic-full-name
	default-branch = !git symbolic-ref refs/remotes/upstream/HEAD | sed 's@^refs/remotes/upstream/@@'

	delete-merged = !git branch -a --merged | grep personal | tail -n+2  | cut -d/ -f3- | xargs git push personal --delete --no-verify
	mr = !sh -c 'git fetch $1 merge-requests/$2/head:mr-$2 && git checkout mr-$2' -

[status]
	showUntrackedFiles = all
[diff]
	# diff.external is configured in .profile; see the comment there
	algorithm = histogram
	colorMoved = dimmed-zebra
	colorMovedWS = ignore-space-change
	ignoreSubmodules = dirty
[checkout]
	workers = 0
	guess = false
[fetch]
	recurseSubmodules = no
	parallel = 0
[merge]
	tool = meld
	conflictstyle = zdiff3
[sendemail]
	smtpserver = smtp.gmail.com
	smtpserverport = 587
	smtpencryption = tls
[pull]
	rebase = true
[feature]
	# breaks libgit on windows: https://github.com/libgit2/libgit2/issues/6531
	# manyFiles = true
# otherwise git has a nasty habit of putting stmpPass in a common file
[include]
	path = ~/.local/gitconfig
[rebase]
	autostash = true
	autoSquash = true
[revise]
	autoSquash = true
[commit]
	verbose = true
	cleanup = scissors
[protocol "file"]
	allow = always
[rerere]
	enabled = true
[advice]
	detachedHead = false
[init]
	defaultBranch = main
[am]
	threeWay = true
[log]
	follow = true
	diffMerges = combined
	showSignature = false
[branch]
	sort = committerdate
[tag]
	sort = taggerdate

[url "git@github.com:"]
    pushInsteadOf = https://github.com/
[url "git@gitlab.com:"]
    pushInsteadOf = https://gitlab.com/
[url "git@codeberg.org:"]
    pushInsteadOf = https://codeberg.org

# TODO: figure out what this does lol
[core]
    packedGitLimit = 512m
    packedGitWindowSize = 512m
	untrackedCache = true
	fsmonitor = true
[pack]
    deltaCacheSize = 2047m
    packSizeLimit = 2047m
    windowMemory = 2047m
[absorb]
	autoStageIfNothingStaged = true
[submodule "src/llvm-project"]
	ignore = dirty
[submodule "src/gcc"]
	ignore = dirty
