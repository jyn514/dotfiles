#!/usr/bin/env bash
set -eu

if [[ "$1" =~ (https://github.com/[^/]*/[^/]*)/(\?tab=readme*|blob/|tree/) ]]; then
	URL=${BASH_REMATCH[1]}.git
else
	case $1 in
		(https://* | ssh://* | git@*) URL=$1  ;;
		(*) URL=https://github.com/$1.git  ;;
	esac
fi

# https://stackoverflow.com/a/13840631
DIR=${2:-$(echo "$URL" | sed -e 's|/$||' -e 's|:*/*\.git$||' -e 's|.*[/:]||g')}
HOST=$(echo "$URL" | sed -e 's,^https://,,; s/^[^@]*@//' | cut -d: -f1 | cut -d/ -f1)

git clone --filter=blob:none "$URL" "$DIR"

builtin cd "$DIR"
git remote rename origin upstream
git remote add origin "git@$HOST:jyn514/$DIR".git
echo "$DIR"
