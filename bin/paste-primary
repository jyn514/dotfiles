#!/bin/sh
set -x
data=$(paste --primary)
if [ "$data" ]; then
	# hack: pasting from primary works horribly in firefox
	old=$(paste)
	echo "$data" | copy
	if command -v ydotool >/dev/null; then
		# see /usr/include/linux/input-event-codes.h
		ydotool key 135:1 135:0
	else
		xdotool key --window "$(xdotool getactivewindow)" XF86Paste
	fi
	sleep .1  # give firefox time to handle the event
	echo "$old" | copy
fi | logger -t paste-primary
